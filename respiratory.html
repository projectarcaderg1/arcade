<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>A.R.C.A.D.E</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- AFRAME + MINDAR -->
<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>

<style>
body{
margin:0;
font-family:Arial;
background:linear-gradient(135deg,#050522,#0a0033,#140044);
color:white;
overflow:hidden;
}

/* CAMERA FIX */
a-scene{
position:fixed !important;
top:0;
left:0;
width:100%;
height:100%;
z-index:1;
}

/* UI PANEL */
.ui{
position:fixed;
bottom:0;
width:100%;
background:rgba(10,0,40,0.85);
padding:15px;
border-top:2px solid #7a5cff;
z-index:2;
text-align:center;
backdrop-filter:blur(10px);
}

h2{
margin:5px;
color:#9cf;
text-shadow:0 0 10px #6cf,0 0 20px #a0f;
}

button{
background:linear-gradient(45deg,#3a6cff,#a020f0);
border:none;
color:white;
padding:10px 15px;
margin:5px;
border-radius:10px;
font-size:14px;
box-shadow:0 0 10px #7af;
cursor:pointer;
}

textarea{
width:90%;
height:60px;
border-radius:10px;
border:none;
padding:8px;
margin-top:5px;
}

#points{
font-size:18px;
color:#7cffea;
text-shadow:0 0 10px cyan;
}

#loading{
position:fixed;
top:50%;
left:50%;
transform:translate(-50%,-50%);
background:#000a;
padding:15px;
border-radius:12px;
z-index:5;
}

.emoji{
position:fixed;
font-size:30px;
animation:pop 1s ease forwards;
pointer-events:none;
}

@keyframes pop{
0%{transform:scale(0);}
50%{transform:scale(1.5);}
100%{transform:translateY(-120px);opacity:0;}
}
</style>
</head>

<body>
<div id="loading">üî¨ Loading AR Experience...</div>

<a-scene mindar-image="imageTargetSrc: targets/respiratory.mind;"
vr-mode-ui="enabled:false" device-orientation-permission-ui="enabled:false"
renderer="colorManagement:true">

<a-assets timeout="10000">
<a-asset-item id="respModel" src="models/respiratory-optimized.glb"></a-asset-item>
</a-assets>

<a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

<a-light type="ambient" intensity="1"></a-light>
<a-light type="directional" position="1 1 1" intensity="1"></a-light>

<!-- MINDAR TARGET -->
<a-entity mindar-image-target="targetIndex:0">
<a-gltf-model
id="lungModel"
src="#respModel"
position="0 0 0"
scale="0.005 0.005 0.005"
rotation="0 0 0"
visible="false"
animation="property: rotation; to: 0 360 0; loop: true; dur: 20000">
</a-gltf-model>
</a-entity>

</a-scene>

<!-- UI -->
<div class="ui">
<h2>ü´Å Respiratory System</h2>
<div id="points">Points: 0 ‚≠ê</div>
<button onclick="listenLesson()">üîä Listen</button><br>
<textarea id="reflection" placeholder="What did you learn?"></textarea><br>
<button onclick="submitReflection()">Submit Reflection</button>
</div>

<script>
let points=0;

// Remove loading screen when AR scene ready
document.querySelector("a-scene").addEventListener("loaded",()=>{
document.getElementById("loading").style.display="none";
});

// Lesson text
const lessonText="The respiratory system helps the body breathe. Oxygen enters the lungs and carbon dioxide leaves the body.";

// Listen button
function listenLesson(){
const speech=new SpeechSynthesisUtterance(lessonText);
speech.rate=0.9;
speech.pitch=1;
speech.lang="en-US";
speechSynthesis.speak(speech);
emojiBurst();
}

// Submit reflection
function submitReflection(){
const text=document.getElementById("reflection").value;
if(text.trim()===""){alert("Write your reflection first!"); return;}
points+=10;
document.getElementById("points").innerText="Points: "+points+" ‚≠ê";
emojiBurst();
if(points>=10){confettiExplosion();}
}

// Emoji burst small
function emojiBurst(){
const emojis=["‚ú®","üéâ","‚≠ê","üí´","üß†"];
for(let i=0;i<6;i++){
const e=document.createElement("div");
e.className="emoji";
e.innerText=emojis[Math.floor(Math.random()*emojis.length)];
e.style.left=Math.random()*100+"vw";
e.style.top="80vh";
document.body.appendChild(e);
setTimeout(()=>e.remove(),1000);
}
}

// Big confetti explosion
function confettiExplosion(){
for(let i=0;i<25;i++){setTimeout(emojiBurst,i*80);}
}

// Step 4: Show model instantly when marker is scanned
const target=document.querySelector('[mindar-image-target]');
const model=document.querySelector('#lungModel');

target.addEventListener("targetFound",()=>{model.setAttribute("visible",true);});
target.addEventListener("targetLost",()=>{model.setAttribute("visible",false);});

</script>
</body>
</html>
