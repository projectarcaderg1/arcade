<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>A.R.C.A.D.E Respiratory</title>

<script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>

<style>

/* FULL CAMERA FIX */
html, body{
  margin:0;
  height:100%;
  overflow:hidden;
  font-family:Arial;
  background:black;
}

a-scene{
  position:fixed !important;
  top:0;
  left:0;
  width:100%;
  height:100%;
  z-index:0;
}

/* UI ABOVE CAMERA */
#ui{
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  width:90%;
  max-width:420px;
  background:rgba(10,10,40,0.85);
  padding:15px;
  border-radius:15px;
  text-align:center;
  color:white;
  z-index:10;   /* IMPORTANT */
}

button{
  padding:10px;
  margin:6px;
  border:none;
  border-radius:10px;
  background:linear-gradient(45deg,#3b82f6,#a855f7);
  color:white;
  font-size:16px;
}

textarea{
  width:95%;
  height:70px;
  border-radius:8px;
}

/* Confetti */
.emoji{
  position:fixed;
  font-size:28px;
  animation:fly 1s forwards;
  z-index:20;
}

@keyframes fly{
  from{transform:scale(0);}
  to{transform:translateY(-140px) scale(1.5);opacity:0;}
}

</style>
</head>

<body>

<!-- AR SCENE -->
<a-scene
 mindar-image="imageTargetSrc: targets/respiratory.mind;"
 vr-mode-ui="enabled:false"
 device-orientation-permission-ui="enabled:true"
 renderer="colorManagement:true">

<a-assets>
<a-asset-item id="respModel"
src="models/ImageToStl.com_respiratory-system.glb">
</a-asset-item>
</a-assets>

<a-light type="ambient" intensity="1"></a-light>
<a-light type="directional" position="0 2 1"></a-light>

<a-entity mindar-image-target="targetIndex:0">

<a-gltf-model
src="#respModel"
position="0 0 0"
scale="0.2 0.2 0.2"
rotation="0 0 0"
animation="property: rotation; to:0 360 0; loop:true; dur:15000">
</a-gltf-model>

</a-entity>

<a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

</a-scene>

<!-- UI -->
<div id="ui">

<div id="points">Points: 0 ‚≠ê</div>

<button id="listenBtn">üîä Listen Lesson</button>
<button id="submitBtn">‚úÖ Submit</button>

<p>Reflection:</p>
<textarea id="reflection"></textarea>

</div>

<script>

let points=0;
let listened=false;

/* LISTEN BUTTON FIX */
document.getElementById("listenBtn").onclick=function(){

const speech=new SpeechSynthesisUtterance(
"The respiratory system allows us to breathe. Oxygen enters the lungs and carbon dioxide leaves the body."
);

speech.rate=0.9;
speech.pitch=1.1;

speechSynthesis.cancel();
speechSynthesis.speak(speech);

listened=true;
emojiBurst();
};


/* SUBMIT BUTTON */
document.getElementById("submitBtn").onclick=function(){

const text=document.getElementById("reflection").value;

if(!listened){
alert("Listen to the lesson first.");
return;
}

if(text.length<5){
alert("Write a longer reflection.");
return;
}

points+=10;
document.getElementById("points").innerText=
"Points: "+points+" ‚≠ê";

emojiBurst(true);
};


/* CONFETTI */
function emojiBurst(big=false){

const emojis=big?
["üéâ","‚ú®","‚≠ê","üöÄ","üåü","üí´"]:
["‚ú®","‚≠ê"];

for(let i=0;i<(big?25:6);i++){

const e=document.createElement("div");
e.className="emoji";
e.innerText=emojis[Math.floor(Math.random()*emojis.length)];

e.style.left=Math.random()*window.innerWidth+"px";
e.style.top=window.innerHeight+"px";

document.body.appendChild(e);

setTimeout(()=>e.remove(),1000);
}
}

</script>

</body>
</html>
